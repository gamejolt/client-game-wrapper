{"version":3,"sources":["index.ts"],"names":[],"mappings":"AAAA,YAAY,CAAC;AAEb,MAAY,EAAE,WAAM,IAAI,CAAC,CAAA;AACzB,MAAY,GAAG,WAAM,KAAK,CAAC,CAAA;AAC3B,MAAY,IAAI,WAAM,MAAM,CAAC,CAAA;AAC7B,MAAY,EAAE,WAAM,eAAe,CAAC,CAAA;AAEpC;IAEC,OAAe,oBAAoB;QAElC,IAAI,SAAS,GAAG,IAAI,CAAC,OAAO,CAAE,SAAS,EAAE,IAAI,EAAE,KAAK,CAAE,CAAC;QACvD,MAAM,CAAC,CAAE,OAAO,CAAC,QAAS,CAAC,CAAC,CAAC;YAC5B,KAAK,OAAO;gBACX,MAAM,CAAC,IAAI,CAAC,IAAI,CAAE,SAAS,EAAE,kCAAkC,CAAE,CAAC;YACnE,KAAK,OAAO;gBACX,MAAM,CAAC,IAAI,CAAC,IAAI,CAAE,SAAS,EAAE,8BAA8B,CAAE,CAAC;YAC/D,KAAK,QAAQ;gBACZ,MAAM,CAAC,IAAI,CAAC,IAAI,CAAE,SAAS,EAAE,4BAA4B,CAAE,CAAC;QAC9D,CAAC;QAED,0BAA0B;QAC1B,MAAM,IAAI,KAAK,CAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,GAAG,IAAI;YAC/C,sGAAsG;YACtG,yCAAyC,CAAE,CAAC;IAC9C,CAAC;IAED,OAAe,YAAY;QAE1B,GAAG,CAAC,CAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAG,CAAC;YAC9B,2CAA2C;YAC3C,IAAI,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,KAAK,CAAE,IAAI,CAAC,MAAM,EAAE,GAAG,CAAE,MAAM,GAAG,IAAI,CAAE,CAAE,CAAC;YAClE,IAAI,MAAM,GAAG,GAAG,CAAC,YAAY,EAAE,CAAC;YAChC,MAAM,CAAC,MAAM,CAAE,IAAI,CAAE,CAAC;YACtB,MAAM,CAAC,KAAK,EAAE,CAAC;YACf,MAAM,CAAC,IAAI,CAAC;QACb,CAAC;QACD,MAAM,CAAC,CAAC,CAAC;IACV,CAAC;IAED,OAAO,KAAK,CAAE,SAAiB,EAAE,GAAW,EAAE,IAAc,EAAE,OAAyB;QAEtF,IAAI,iBAAiB,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QACpD,IAAI,WAAW,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QAEtC,sDAAsD;QACtD,EAAE,CAAC,SAAS,CAAE,iBAAiB,EAAE,MAAM,CAAE,CAAC;QAE1C,IAAI,KAAK,GAAG,EAAE,CAAC,KAAK,CAAE,iBAAiB,EAAE,CAAE,SAAS,EAAE,GAAG,EAAE,WAAW,CAAC,QAAQ,EAAE,CAAE,CAAC,MAAM,CAAE,IAAI,CAAE,EAAE,OAAO,CAAE,CAAC;QAC9G,KAAK,CAAC,KAAK,EAAE,CAAC;QAEd,MAAM,CAAC,WAAW,CAAC;IACpB,CAAC;AACF,CAAC;AAED,iBAAS,WAAW,CAAC","file":"index.js","sourcesContent":["'use strict';\n\nimport * as fs from 'fs';\nimport * as net from 'net';\nimport * as path from 'path';\nimport * as cp from 'child_process';\n\nclass GameWrapper\n{\n\tprivate static getWrapperExecutable()\n\t{\n\t\tlet binFolder = path.resolve( __dirname, '..', 'bin' );\n\t\tswitch ( process.platform ) {\n\t\t\tcase 'win32':\n\t\t\t\treturn path.join( binFolder, 'game_jolt_game_wrapper_win32.exe' );\n\t\t\tcase 'linux':\n\t\t\t\treturn path.join( binFolder, 'game_jolt_game_wrapper_linux' );\n\t\t\tcase 'darwin':\n\t\t\t\treturn path.join( binFolder, 'game_jolt_game_wrapper_osx' );\n\t\t}\n\n\t\t// Plan for the future, yo\n\t\tthrow new Error( new Date().getFullYear() > 2100 ?\n\t\t\t'Pepperidge Farm remembers back in 2016 we were still using Windows, Linux or Mac. Kids these days...' :\n\t\t\t'What kind of potato are you running on?' );\n\t}\n\n\tprivate static findFreePort()\n\t{\n\t\tfor ( let i = 0; i < 5; i++ ) {\n\t\t\t// Get a random port between 1024 and 65535\n\t\t\tlet port = 1024 + Math.floor( Math.random() * ( 0xFFFF - 1024 ) );\n\t\t\tlet server = net.createServer();\n\t\t\tserver.listen( port );\n\t\t\tserver.close();\n\t\t\treturn port;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tstatic start( wrapperId: string, cmd: string, args: string[], options?: cp.SpawnOptions )\n\t{\n\t\tlet wrapperExecutable = this.getWrapperExecutable();\n\t\tlet wrapperPort = this.findFreePort();\n\n\t\t// Ensure that the wrapper executable is.. executable.\n\t\tfs.chmodSync( wrapperExecutable, '0755' );\n\t\t\n\t\tlet child = cp.spawn( wrapperExecutable, [ wrapperId, cmd, wrapperPort.toString() ].concat( args ), options );\n\t\tchild.unref();\n\n\t\treturn wrapperPort;\n\t}\n}\n\nexport = GameWrapper;\n"],"sourceRoot":"../src/"}